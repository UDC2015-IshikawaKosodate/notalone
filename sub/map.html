<!DOCTYPE html>
<html>
    <head>
        <title>能登ノットアローン｜マップ</title>
	<link rel="stylesheet" href="../css/notalone.css">


        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
        <!-- Sets initial viewport load and disables zooming  -->
        <meta name="viewport" content="initial-scale=1, maximum-scale=1">

        <!-- Makes your prototype chrome-less once bookmarked to your phone's home screen -->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="apple-touch-icon-precomposed" href="img/icon.png" />

        <!-- Include the compiled Ratchet CSS -->
        <link href="css/ratchet.css" rel="stylesheet">

        <!-- Include the compiled Ratchet JS -->
        <script src="js/ratchet.js"></script>

        <!-- Include fork origin -->
        <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet">
        <link href="css/main.css" rel="stylesheet">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js"></script>
        <script src="js/main.js"></script>

        <!-- Include bookmark_bubble -->
        <!--script src="js/mobile-bookmark-bubble/bookmark_bubble.js"></script-->
        <!--script src="js/mobile-bookmark-bubble/example/example.js"></script-->

    </head>

    <body onload="initlaize(); map_fit();">

        <!-- Make sure all your bars are the first things in your <body> -->
        <header class="bar bar-nav">
	    <div id="top-menu" onClick="top_index()"></div>
            <!--h1 class="title">子育て応援マップ</h1-->
        </header>

        <div class="content">
            <div id="loading" style="font-color:#ffffff">Now Loading....</div>
            <div id="map_canvas" style="width:100%; height:480px;"></div>
        </div>
        <nav class="bar bar-tab" style="display:block;">
	    <select id="mapSelecter">
		<option value="1">あそべるところ、公園、図書館</option>
		<option value="2">なんでも相談できるところ</option>
		<option value="3">オムツ替えのしやすいところ（赤ちゃんの駅）</option>
		<option value="4">子連れでお茶やご飯がしやすいところ</option>
		<option value="5">病院、学校、こども園</option>
		<option value="6">病後時保育が相談できるところ</option>
		<option value="7">プレミアム・パスポートの使えるところ</option>
		<option value="0">---（ピンを消す）---</option>
	    </select>
		<input type="button" onClick="clearMapPins()" value="ピンを消す" />
	</nav>
    </body>
</html>

<script type="text/javascript">

//** notalone *****
var TopHeight = 30;				//トップメニューの縦幅
	$("#top-menu").height(TopHeight);
	$("#top-menu").css({"line-height" : TopHeight + "px"});


	//****for index.html *******
	$("#menu-back").height(TopHeight);
	$("#menu-back").css({"line-height" : TopHeight + "px"});

//topメニュー
function top_index(){
	location.href = "../index.html";
}

//******************

function map_fit(){
	//ブラウザの縦サイズにフィットさせる
	//上下に設置するdiv縦幅
	var ajust = 81;
	//var ajust = 50;
	$('#map_canvas').css({
		'height' : (window.innerHeight - ajust) + "px",
		'width'  : window.innerWidth + "px"
	});

}

//window risize 時の処理
$(window).resize(function(){
	map_fit();
});

//****** カテゴリアイコン対応 ******
var iconArray = new Array(); 		//２次元：連想配列

/***  categoryicon csv format 変換テーブル  ****/
var Cat_name  = "category";	  	//
var Def_dir   = "default_directory";	//
var Def_icon  = "default_icon";		//
var Big_dir   = "big_directory";	//
var Big_icon  = "big_icon";		//
var Zoom_level= "zoom_level";		//
/*********/

//CategoryIcon tableの読み込み
//var table = "../localhost/categoryicon.csv";
//readCategoryIcon(table);


//****** 複数マップの対応機能 ******

//マップの選択
var mapNo = 1;
$('#mapSelecter').change(function(){
	$('#mapSelecter option:selected').each(function(){
		mapNo = parseInt($(this).val());
	});
	//alert(mapNo);
	if(mapNo == 0){
		clearMapPins();
	}else{
		pushPins(googlemap);
	}
}).change();

//ピン情報保存用の配列
var markersArray = new google.maps.MVCArray();
function clearMapPins(){
	markersArray.forEach(function (marker, idx) { marker.setMap(null); });
	mapPinsArray = new Array();
}

//個別マップ対応テーブル
var _MapTable;
var _DefPin;
var _BigPin;

var _Category;
var _1st_id;
var _2nd_id;
var _Name;
var _Address;
var _Tel;
var _Url;
var _Opentime;
var _Restdates;
var _Description;
var _Lat;
var _Lng;

function mapConvertTable(mapNo){ 

	switch(mapNo){
		//あそべるところ、公園、図書館
		case 1 :
	
		_MapTable	= '../uploads/mapinfo/reisiu_wajima_asoberutokoro.csv';
		_DefPin		= 'icons/pink-pushpin.png';
		_BigPin		= '';

		_Category 	= 'category';
		_Name 		= 'name';
		_Address	= 'address';
		_Tel		= 'phone1';
		_Url		= '';
		_Opentime	= '';
		_Restdates	= '';
		_Description	= 'memo';	//1〜2 あるので先頭のみ指定
		_Lat		= 'lat';
		_Lng		= 'lng';

       		break;

		//なんでも相談できるところ
		case 2 :
	
		_MapTable	= '../uploads/mapinfo/reisiu_noto_nandemosoudan.csv';
		_DefPin		= 'icons/ltblu-pushpin.png';
		_BigPin		= '';

		_Category 	= 'category';
		_Name 		= 'name';
		_Address	= 'address';
		_Tel		= '';
		_Url		= '';
		_Opentime	= '';
		_Restdates	= '';
		_Description	= 'memo';	//1〜2 あるので先頭のみ指定
		_Lat		= 'lat';
		_Lng		= 'lng';

       		break;

		//オムツ替えのしやすいところ（赤ちゃんの駅）
		case 3 :
	
		_MapTable	= '../uploads/mapinfo/openData_baby.csv';
		_DefPin		= 'icons/green-pin.png';
		_BigPin		= '';

		_Category 	= '';
		_1st_id		= 'co_id';
		_2nd_id		= 'shop_id';
		_Name 		= 'name';
		_Address	= 'address';
		_Tel		= 'phone';
		_Url		= 'url';
		_Opentime	= 'servicetime';
		_Restdates	= 'holiday';
		_Description	= 'op_';	//1〜13 あるので先頭のみ指定
		_Lat		= 'lat';
		_Lng		= 'lng';

       		break;

		//子連れでお茶やご飯がしやすいところ
		case 4 :

		//病院、学校、こども園
		case 5 :

		alert("ただいま、準備中です");

		break;


		//病後時保育が相談できるところ
		case 6 :
	
		_MapTable	= '../uploads/mapinfo/reisiu_ishikawa_byougojihoiku.csv';
		_DefPin		= 'icons/yellow-pin.png';
		_BigPin		= '';

		_Category 	= 'category';
		_Name 		= 'name';
		_Address	= 'address';
		_Tel		= 'phone1';
		_Url		= '';
		_Opentime	= '';
		_Restdates	= '';
		_Description	= 'memo';	//1〜2 あるので先頭のみ指定
		_Lat		= 'lat';
		_Lng		= 'lng';

       		break;

		//プレミアム・パスポートの使えるところ
		case 7 :
	
		_MapTable	= '../uploads/mapinfo/openData_prepass.csv';
		_DefPin		= 'icons/red_pin.png';
		_BigPin		= '';

		_Category 	= '';
		_1st_id		= 'co_id';
		_2nd_id		= 'shop_id';
		_Name 		= 'name';
		_Address	= 'address';
		_Tel		= 'phone';
		_Url		= 'url';
		_Opentime	= 'servicetime';
		_Restdates	= 'holiday';
		_Description	= 'prepass';
		_Lat		= 'lat';
		_Lng		= 'lng';

       		break;

	}
}

function mapMakeInfo(mapNo,data){
	switch(mapNo){

		//あそべるところ、公園、図書館
		case 1 :

	    //備考のまとめ
	    var head =　_Description;
	    var opt  = ""; 
	    for(var i = 1 ; i <= 2 ; i++){
		if(data[head + i] != ""){
			opt += data[head + i] + "/";
		}
	    }
	    //***********


            var html = "";
            html +="<div style='width:150px;padding:0px;'>"
            html += data[_Category];

	    html += "<h5>" + data[_Name] + "</h5>";

            html += "<dl>";
            html += "<dd>" + data[_Address] + "</dd>";
            html += "<dd>" + data[_Tel] + "</dd>";
            html += "<dd>" + opt + "</dd>";
            html += "</dl>";
            html += "</div>";

		break;

		//なんでも相談できるところ
		case 2 :

	    //備考のまとめ
	    var head =　_Description;
	    var opt  = ""; 
	    for(var i = 1 ; i <= 2 ; i++){
		if(data[head + i] != ""){
			opt += data[head + i] + "/";
		}
	    }
	    //***********

            var html = "";
            html +="<div style='width:150px;padding:0px;'>"
            html += data[_Category];

	    html += "<h5>" + data[_Name] + "</h5>";

            html += "<dl>";
            html += "<dd>" + data[_Address] + "</dd>";
            html += "<dd>" + data[_Description] + "</dd>";
            html += "</dl>";
            html += "</div>";

		break;


		//オムツ替えのしやすいところ（赤ちゃんの駅）
		case 3 :

	    //var image = getSpotImage(data[_1st_id], data[_2nd_id]);

	    //赤ちゃんサービスのまとめ
	    var head =　_Description;
	    var opt  = ""; 
	    for(var i = 1 ; i <= 13 ; i++){
		if(data[head + i] != ""){
			opt += data[head + i] + "/";
		}
	    }
	    //***********


            var html = "";
            html +="<div style='width:150px;padding:0px;'>"
            html +="赤ちゃんの駅";

            if (data[_Url].length) {
                html += "<a target='_blank' href='"+ data[_Url] + "'><h5>" + data[_Name] + "</h5></a>";
            }else{
		html += "<h5>" + data[_Name] + "</h5>";
	    }

	    /*
	    if(image != ""){
            	html += "<p style='text-align:center'><img src='" + image + "' width='120' ></p>";
	    }
	    */

            html += "<dl>";
            html += "<dd>" + data[_Address] + "</dd>";
            html += "<dd>" + data[_Tel] + "</dd>";
            html += "<dd>営業：" + data[_Opentime] + "</dd>";
            html += "<dd>定休：" + data[_Restdates] + "</dd>";
            html += "<dd>" + opt + "</dd>";
            html += "</dl>";
            html += "</div>";

		break;


		//病後時保育が相談できるところ
		case 6 :

	    //備考のまとめ
	    var head =　_Description;
	    var opt  = ""; 
	    for(var i = 1 ; i <= 2 ; i++){
		if(data[head + i] != ""){
			opt += data[head + i] + "/";
		}
	    }
	    //***********


            var html = "";
            html +="<div style='width:150px;padding:0px;'>"
            html +="保育サポート<br />";
            html += data[_Category];

	    html += "<h5>" + data[_Name] + "</h5>";

            html += "<dl>";
            html += "<dd>" + data[_Address] + "</dd>";
            html += "<dd>" + data[_Tel] + "</dd>";
            html += "<dd>" + opt + "</dd>";
            html += "</dl>";
            html += "</div>";

		break;

/*
		//子育て相談施設
		case 4 :

	    var image = getSpotImage(data[_1st_id], data[_2nd_id]);

	    //備考のまとめ
	    var head =　_Description;
	    var opt  = ""; 
	    for(var i = 1 ; i <= 2 ; i++){
		if(data[head + i] != ""){
			opt += data[head + i] + "/";
		}
	    }
	    //***********


            var html = "";
            html +="<div style='width:150px;padding:0px;'>"
            html +="子育て相談<br />";
            html += data[_Category];

	    html += "<h5>" + data[_Name] + "</h5>";

            html += "<dl>";
            html += "<dd>" + data[_Address] + "</dd>";
            html += "<dd>" + data[_Tel] + "</dd>";
            html += "<dd>" + opt + "</dd>";
            html += "</dl>";
            html += "</div>";

		break;
*/


		//プレミアム・パスポートの使えるところ
		case 7 :

	    //var image = getSpotImage(data[_1st_id], data[_2nd_id]);

            var html = "";
            html += "<div style='width:150px;padding:0px;'>"
            html +="プレミアムパスポート";

            if (data[_Url].length) {
                html += "<a target='_blank' href='"+ data[_Url] + "'><h5>" + data[_Name] + "</h5></a>";
            }else{
		html += "<h5>" + data[_Name] + "</h5>";
	    }

	    /*
	    if(image != ""){
            	html += "<p style='text-align:center'><img src='" + image + "' width='120' ></p>";
	    }
	    */

            html += "<dl>";
            html += "<dd>" + data[_Address] + "</dd>";
            html += "<dd>" + data[_Tel] + "</dd>";
            html += "<dd>営業：" + data[_Opentime] + "</dd>";
            html += "<dd>定休：" + data[_Restdates] + "</dd>";
            html += "<dd>" + data[_Description] + "</dd>";
            html += "</dl>";
            html += "</div>";

		break;
	
	}

	return html;
}

//プレパス、赤ちゃんの駅　画像取得用
function getSpotImage(coid, ofid)
{
	var url = "http://www.i-oyacomi.net/prepass/upimages/" + coid + ofid + "ofPic1_small.jpg";
	var img = new Image();
    	img.src = url;

	if(img.height > 0){
        	return url;
	}else{
		return "";
	}
}
</script>
